---
- name: {{ playbook_name }}
  hosts: {{ target_hosts }}
{% if become %}
  become: true
{% endif %}
{% if options_enabled and not gather_facts %}
  gather_facts: false
{% endif %}
{% if secrets_enabled %}
  vars_files:
    - {{ secrets_file }}
{% endif %}
  vars:
    server_url: {{ checkmk_server_url }}
    site: {{ checkmk_site }}

  tasks:
    - name: "Create host"
      checkmk.general.host:
        server_url: {{ '{{' }} server_url {{ '}}' }}
        site: {{ '{{' }} site {{ '}}' }}
        automation_user: {{ '{{' }} automation_user {{ '}}' }}
        automation_secret: {{ '{{' }} automation_secret {{ '}}' }}
        name: {{ host_name }}
        attributes:
          ipaddress: {{ host_ip }}
        folder: {{ host_folder }}
        state: "present"
