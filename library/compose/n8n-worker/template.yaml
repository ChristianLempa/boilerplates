---
kind: compose
schema: "1.1"
metadata:
  name: N8N Worker
  description: >
    N8n Worker component for scaled queue-based deployments.
    This template provides standalone worker nodes that process workflows
    from the queue (Redis). Workers connect to the same database and Redis
    as the n8n server but do not serve the web UI.


    Use this template in combination with n8n-server configured with queue mode.
    Multiple workers can be deployed to scale workflow execution.


    Project: https://n8n.io/

    Documentation: https://docs.n8n.io/

    GitHub: https://github.com/n8n-io/n8n
  version: 1.118.1
  author: Christian Lempa
  date: '2025-11-02'
  tags:
    - automation
    - workflow
    - swarm
  next_steps: |
    {% if swarm_enabled -%}
    1. Ensure secrets are created (shared with n8n-server):
       echo "your-encryption-key" | docker secret create {{ encryption_key_secret_name }} -
       {% if database_enabled and database_type == 'postgres' -%}
       echo "your-db-password" | docker secret create {{ database_password_secret_name }} -
       {%- endif %}
    2. Deploy to Docker Swarm:
       docker stack deploy -c compose.yaml {{ service_name }}
    {% else -%}
    1. Start n8n worker with Docker Compose:
       docker compose up -d
    {% endif -%}
    2. Workers will automatically connect to Redis and begin processing queued workflows
spec:
  general:
    vars:
      service_name:
        default: "n8n-worker"
      container_name:
        default: "n8n-worker"
      container_hostname:
        default: "n8n-worker"
  redis:
    title: "Redis Connection"
    description: "Redis queue connection (must match n8n-server configuration)"
    required: true
    vars:
      redis_host:
        type: str
        description: "Redis host"
        default: "redis"
      redis_port:
        type: int
        description: "Redis port"
        default: 6379
  database:
    title: "Database"
    description: "External database configuration (must match n8n-server)"
    required: true
    vars:
      database_enabled:
        type: bool
        description: "Use external database"
        default: true
      database_type:
        type: enum
        description: "Database type"
        options:
          - "postgres"
          - "mysql"
        default: "postgres"
        needs: "database_enabled"
      database_host:
        type: str
        description: "Database host"
        default: "postgres"
        needs: "database_enabled"
      database_port:
        type: int
        description: "Database port"
        default: 5432
        needs: "database_enabled"
      database_name:
        type: str
        description: "Database name"
        default: "n8n"
        needs: "database_enabled"
      database_user:
        type: str
        description: "Database username"
        default: "n8n"
        needs: "database_enabled"
      database_password:
        type: str
        description: "Database password"
        sensitive: true
        needs: "database_enabled"
  security:
    title: "Security"
    required: true
    vars:
      encryption_key:
        type: str
        description: "N8N encryption key (must match server)"
        sensitive: true
        autogenerated: true
        extra: "CRITICAL: Must be identical to the n8n-server encryption key!"
  metrics:
    title: "Metrics"
    description: "Prometheus metrics configuration"
    vars:
      metrics_enabled:
        type: bool
        description: "Enable Prometheus metrics"
        default: false
      metrics_detailed:
        type: bool
        description: "Include detailed metrics (workflows, nodes)"
        default: false
        needs: "metrics_enabled"
  network:
    vars:
      network_mode:
        extra: "Use 'bridge' with shared network to connect to Redis and database. Swarm only supports 'bridge'."
      network_name:
        default: "n8n_network"
  swarm:
    vars:
      swarm_enabled:
        needs: "network_mode=bridge"
      swarm_replicas:
        type: int
        description: "Number of worker replicas"
        default: 1
        needs: "swarm_enabled"
        extra: "Scale workers based on workload (typically 1-5)"
      encryption_key_secret_name:
        type: str
        description: "Docker Swarm secret name for encryption key"
        default: "n8n_encryption_key"
        needs: "swarm_enabled"
      database_password_secret_name:
        type: str
        description: "Docker Swarm secret name for database password"
        default: "n8n_database_password"
        needs: ["swarm_enabled", "database_enabled"]
