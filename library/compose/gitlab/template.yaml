---
kind: compose
metadata:
  name: GitLab
  description: 'A **complete DevOps platform** that provides Git repository management, CI/CD pipelines,

    issue tracking, and container registry in a single application.

    ## Prerequisites

    - ...

    **Performance Presets**:

    - `homelab`: Optimized for low-resource environments (limited workers, reduced PostgreSQL buffers)

    - `default`: Standard server configuration for production use

    **External URL**:

    - Set to your public domain (e.g., `https://gitlab.example.com`) for proper clone URLs

    - Affects SSH clone URLs and web links in emails/notifications

    **Container Registry**:

    - Enable if you need private Docker image hosting

    - Requires separate external URL (e.g., `https://registry.example.com`)

    ## Resources

    - **Project**: https://about.gitlab.com/

    - **Documentation**: https://docs.gitlab.com/

    - **Community**: https://forum.gitlab.com/

    '
  icon:
    provider: selfh
    id: gitlab
  version: 18.5.4-ce.0
  author: Christian Lempa
  date: '2025-12-11'
  tags:
    - traefik
    - swarm
  next_steps: "## Post-Installation Steps\n1. **Start GitLab**:\n   ```bash\n   docker compose up -d\n   ```\n2. **Wait for\
    \ initialization** (2-5 minutes):\n   ```bash\n   docker compose logs -f gitlab\n   ```\n   Wait for message: `gitlab\
    \ Reconfigured!`\n3. **Access the web interface**:\n   {% if traefik_enabled -%}\n   - Via Traefik: https://{{ traefik_host\
    \ }}\n   {% if not traefik_enabled and network_mode == 'bridge' %}- Direct access: http://localhost:{{ ports_http }}{%\
    \ endif %}\n   {%- else -%}\n   - Open {{ external_url }} in your browser\n   {% if network_mode == 'bridge' %}- Or: http://localhost:{{\
    \ ports_http }}{% endif %}\n   {%- endif %}\n4. **Initial login credentials**:\n   - **Username**: `root`\n   - **Password**:\
    \ `{{ root_password }}`\n   > **Important**: This password only works on FIRST initialization.\n   > Change it immediately\
    \ after first login via GitLab's web interface!\n5. **Configure SSH** (optional):\n   - SSH clone URLs will use port `{{\
    \ ports_ssh }}`\n   - Update your Git remote if needed\n## Additional Resources\n- Documentation: https://docs.gitlab.com/\n\
    - GitLab Runner: https://docs.gitlab.com/runner/\n"
  draft: true
schema: '1.2'
spec:
  general:
    vars:
      service_name:
        default: gitlab
      external_url:
        type: str
        description: External URL for GitLab
        default: http://localhost
      root_email:
        type: str
        description: Initial root user email address
        default: admin@example.com
      root_password:
        type: str
        description: Initial root user password (only used on first initialization)
        sensitive: true
        autogenerated: true
        extra: 'Leave empty to auto-generate. WARNING: Only sets password on FIRST startup!'
      default_theme:
        type: int
        description: Default GitLab UI theme (2 = dark mode)
        default: 2
        extra: 1 = Indigo, 2 = Dark, 3 = Light, 4 = Blue, 5 = Green
      default_color_mode:
        type: int
        description: Default color mode (2 = dark mode)
        default: 2
        extra: 1 = Light, 2 = Dark
      disable_usage_data:
        type: bool
        description: Disable product usage metrics upload to GitLab
        default: true
      restart_policy:
        type: enum
        options:
          - unless-stopped
          - always
          - on-failure
          - 'no'
        default: unless-stopped
        required: true
  ports:
    vars:
      ports_http:
        default: 80
      ports_ssh:
        default: 2424
      ports_registry:
        type: int
        description: Container Registry port
        default: 5000
  network:
    vars:
      network_name:
        default: gitlab_network
  traefik:
    vars:
      traefik_host:
        default: gitlab.home.arpa
      traefik_registry_host:
        needs:
          - registry_enabled=true
        default: registry.home.arpa
        type: str
        description: Hostname for Container Registry in Traefik (if enabled)
      traefik_network:
        default: traefik
        type: str
        required: true
      traefik_domain:
        default: home.arpa
        type: str
        required: true
      traefik_enabled:
        type: bool
        default: false
        description: Enable Traefik integration
  traefik_tls:
    vars:
      traefik_tls_certresolver:
        type: str
        default: cloudflare
        required: true
      traefik_tls_enabled:
        type: bool
        default: false
        description: Enable Traefik TLS
  volume:
    vars:
      volume_mode:
        type: enum
        options:
          - local
          - mount
          - nfs
        default: local
        required: true
      volume_mount_path:
        type: str
        default: /mnt/storage
        needs:
          - volume_mode=mount
        required: true
      volume_nfs_server:
        type: str
        default: 192.168.1.1
        needs:
          - volume_mode=nfs
        required: true
      volume_nfs_path:
        type: str
        default: /export
        needs:
          - volume_mode=nfs
        required: true
      volume_nfs_options:
        type: str
        default: rw,nolock,soft
        needs:
          - volume_mode=nfs
        required: true
  swarm:
    vars:
      swarm_placement_host:
        type: str
        description: Target hostname for placement constraint
        default: ''
        extra: Constrains service to run on specific node by hostname
      swarm_enabled:
        type: bool
        default: false
        description: Enable Docker Swarm mode
      swarm_placement_mode:
        type: str
        default: replicated
        description: The placement mode
      swarm_replicas:
        type: int
        default: 1
        description: The number of replicas
  registry:
    description: GitLab Container Registry configuration
    toggle: registry_enabled
    vars:
      registry_enabled:
        type: bool
        description: Enable GitLab Container Registry
        default: false
      registry_external_url:
        type: str
        description: External URL for Container Registry
        default: http://localhost:5000
  advanced:
    title: Advanced Settings
    description: Performance tuning and advanced configuration options
    vars:
      performance_preset:
        type: enum
        description: Performance optimization profile
        options:
          - homelab
          - default
        default: homelab
        extra: homelab is optimized for low-resource environments, default is for standard servers
      prometheus_enabled:
        type: bool
        description: Enable Prometheus monitoring
        default: false
        extra: Disabling saves ~200-400MB RAM. GitLab UI metrics will be unavailable.
