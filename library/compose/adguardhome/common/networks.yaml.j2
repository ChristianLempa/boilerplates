---
{#
  Network definitions (only when needed):
  - When network_mode is empty: no definition needed (uses Docker's default bridge)
  - When network_mode is 'bridge': define custom bridge network
  - When network_mode is 'macvlan': configure macvlan with static IP (for Compose mode)
    Note: In Swarm mode, macvlan networks must be created manually with config-only networks on each node
  - When swarm_enabled: use overlay network for multi-host communication
  - Traefik network: always external (managed by Traefik)
#}
{% if network_mode == 'bridge' or network_mode == 'macvlan' or traefik_enabled %}
networks:
  {% if network_mode == 'bridge' or network_mode == 'macvlan'%}
  {{ network_name }}:
    {% if network_external %}
    external: true
    {% else %}
    {% if network_mode == 'macvlan' %}
    driver: macvlan
    driver_opts:
      parent: {{ network_macvlan_parent_interface }}
    ipam:
      config:
        - subnet: {{ network_macvlan_subnet }}
          gateway: {{ network_macvlan_gateway }}
    name: {{ network_name }}
    {% elif swarm_enabled %}
    driver: overlay
    attachable: true
    {% else %}
    driver: bridge
    {% endif %}
    {% endif %}
  {% endif %}
  {% if traefik_enabled %}
  {{ traefik_network }}:
    external: true
  {% endif %}
{% endif %}
