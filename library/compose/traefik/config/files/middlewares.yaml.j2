---
# Traefik Dynamic Middleware Configuration
# This file is watched by Traefik and changes are applied automatically

{% if authentik_enabled -%}
http:
  middlewares:
    # Authentik Forward Auth Middleware
    # Use this middleware in your service labels: traefik.http.routers.myservice.middlewares={{ traefik_authentik_middleware_name }}@file
    {{ traefik_authentik_middleware_name }}:
      forwardAuth:
        address: {{ authentik_outpost_url }}/outpost.goauthentik.io/auth/traefik
        trustForwardHeader: true
        authResponseHeaders:
          - X-authentik-username
          - X-authentik-groups
          - X-authentik-email
          - X-authentik-name
          - X-authentik-uid
          - X-authentik-jwt
          - X-authentik-meta-jwks
          - X-authentik-meta-outpost
          - X-authentik-meta-provider
          - X-authentik-meta-app
          - X-authentik-meta-version

    # Example 1: Security headers
    # security-headers:
    #   headers:
    #     frameDeny: true
    #     browserXssFilter: true
    #     contentTypeNosniff: true
    #     stsSeconds: 31536000
    #
    # Example 2: Rate limiting
    # rate-limit:
    #   rateLimit:
    #     average: 100
    #     burst: 50
{% else -%}
# Uncomment and customize the examples below as needed

# http:
#   middlewares:
#     # Example 1: Security headers
#     security-headers:
#       headers:
#         frameDeny: true
#         browserXssFilter: true
#         contentTypeNosniff: true
#         stsSeconds: 31536000
#
#     # Example 2: Rate limiting
#     rate-limit:
#       rateLimit:
#         average: 100
#         burst: 50
{% endif -%}
