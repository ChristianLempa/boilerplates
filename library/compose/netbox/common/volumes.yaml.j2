{#
  Volume definitions:
  - When volume_mode is 'local' (default): use docker-managed local volumes
  - When volume_mode is 'nfs': configure NFS-backed volumes
  - When volume_mode is 'mount': no volume definition needed (bind mounts used directly)
  Note: Postgres volumes only defined in Compose mode (Swarm uses external database)
#}
{% if volume_mode == 'local' %}
volumes:
  {% if not database_external and not swarm_enabled %}
  {{ service_name }}-postgres:
    driver: local
  {% endif %}
  {{ service_name }}-redis:
    driver: local
  {{ service_name }}-redis-cache:
    driver: local
  {{ service_name }}-media:
    driver: local
  {{ service_name }}-reports:
    driver: local
  {{ service_name }}-scripts:
    driver: local
{% elif volume_mode == 'nfs' %}
volumes:
  {% if not database_external and not swarm_enabled %}
  {{ service_name }}-postgres:
    driver: local
    driver_opts:
      type: nfs
      o: addr={{ volume_nfs_server }},nfsvers=4,{{ volume_nfs_options }}
      device: ":{{ volume_nfs_path }}/postgres"
  {% endif %}
  {{ service_name }}-redis:
    driver: local
    driver_opts:
      type: nfs
      o: addr={{ volume_nfs_server }},nfsvers=4,{{ volume_nfs_options }}
      device: ":{{ volume_nfs_path }}/redis"
  {{ service_name }}-redis-cache:
    driver: local
    driver_opts:
      type: nfs
      o: addr={{ volume_nfs_server }},nfsvers=4,{{ volume_nfs_options }}
      device: ":{{ volume_nfs_path }}/redis-cache"
  {{ service_name }}-media:
    driver: local
    driver_opts:
      type: nfs
      o: addr={{ volume_nfs_server }},nfsvers=4,{{ volume_nfs_options }}
      device: ":{{ volume_nfs_path }}/media"
  {{ service_name }}-reports:
    driver: local
    driver_opts:
      type: nfs
      o: addr={{ volume_nfs_server }},nfsvers=4,{{ volume_nfs_options }}
      device: ":{{ volume_nfs_path }}/reports"
  {{ service_name }}-scripts:
    driver: local
    driver_opts:
      type: nfs
      o: addr={{ volume_nfs_server }},nfsvers=4,{{ volume_nfs_options }}
      device: ":{{ volume_nfs_path }}/scripts"
{% endif %}
