# Ansible Semaphore Application Configuration
# Contains application settings and database connection

# Timezone
TZ={{ container_timezone | default('UTC') }}

# Database Connection
{% if database_type == 'mysql' %}
SEMAPHORE_DB_DIALECT=mysql
{% elif database_type == 'postgres' %}
SEMAPHORE_DB_DIALECT=postgres
{% endif %}
{% if database_external %}
SEMAPHORE_DB_HOST={{ database_host }}
{% else %}
SEMAPHORE_DB_HOST={{ service_name | default('semaphore') }}-{{ database_type }}
{% endif %}
SEMAPHORE_DB_PORT={% if database_type == 'postgres' %}5432{% else %}3306{% endif %}
SEMAPHORE_DB={{ database_name | default('semaphore') }}
SEMAPHORE_DB_USER={{ database_user | default('semaphore') }}
SEMAPHORE_DB_PASS={{ database_password | default('semaphore') }}

# Admin Configuration
SEMAPHORE_ADMIN={{ semaphore_admin_name | default('admin') }}
SEMAPHORE_ADMIN_NAME={{ semaphore_admin_name | default('admin') }}
SEMAPHORE_ADMIN_EMAIL={{ semaphore_admin_email | default('admin@localhost') }}
SEMAPHORE_ADMIN_PASSWORD={{ semaphore_admin_password if semaphore_admin_password else (none | pwgen(20)) }}

# Playbook Configuration
SEMAPHORE_PLAYBOOK_PATH={{ semaphore_playbook_path | default('/tmp/semaphore/') }}

# Access Key Encryption
SEMAPHORE_ACCESS_KEY_ENCRYPTION={{ semaphore_access_key_encryption if semaphore_access_key_encryption else (none | pwgen(32)) }}

# Ansible Settings
ANSIBLE_HOST_KEY_CHECKING={{ ansible_host_key_checking | default(false) }}

{% if email_enabled -%}
# Email Server Configuration
SEMAPHORE_EMAIL_SENDER={{ email_from }}
SEMAPHORE_EMAIL_HOST={{ email_host }}
SEMAPHORE_EMAIL_PORT={{ email_port | default(587) }}
SEMAPHORE_EMAIL_USERNAME={{ email_username }}
SEMAPHORE_EMAIL_PASSWORD={{ email_password }}
SEMAPHORE_EMAIL_SECURE={{ email_use_tls | default(true) }}
{% endif %}
